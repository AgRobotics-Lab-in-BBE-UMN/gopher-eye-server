#!/bin/bash

DB_HOST=${DB_HOST:-"localhost"}
DB_PORT=${DB_PORT:-"5432"}
DB_NAME=${DB_NAME:-"default_db"}
DB_USER=${DB_USER:-"postgres"}
DB_PASSWORD=${DB_PASSWORD:-""}

if [[ -z "$DB_HOST" || -z "$DB_PORT" || -z "$DB_NAME" || -z "$DB_USER" || -z "$DB_PASSWORD" ]]; then
  echo "Error: Missing required environment variables."
  echo "Ensure DB_HOST, DB_PORT, DB_NAME, DB_USER, and DB_PASSWORD are set."
  exit 1
fi

export PGPASSWORD=$DB_PASSWORD

echo "Applying schema from destroy_db.sql..."
psql -h "$DB_HOST" -p "$DB_PORT" -U "$DB_USER" -d "$DB_NAME" -f ./script/sql/destroy_db.sql

if [[ $? -eq 0 ]]; then
  echo "Schema applied successfully."
else
  echo "Error: Failed to apply schema to database '$DB_NAME'."
fi

unset PGPASSWORD
